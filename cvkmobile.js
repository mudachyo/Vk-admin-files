var Vkmobile={setMsisdnPromoCodeUsedCount:function(){if(cur.vkmobileUsedCountOpenedForm){if(cur.vkmobileUsedCountOpenedForm.loading)return;var o=cur.vkmobileUsedCountOpenedForm,e=attr(o,"data-user_id"),s=attr(o,"data-msisdn"),n=attr(o,"data-hash"),r=ge("used_count_form_input_"+e+"_"+s),t=val(r).replace(/[^0-9]/g,""),i=ge("used_count_form_error_"+e+"_"+s);if(hide(i),!t.length)return notaBene(r);ajax.post("/cvkmobile",{act:"a_set_msisdn_promocode_used_count",msisdn:s,count:t,user_id:e,hash:n},{showProgress:function(){cur.vkmobileUsedCountOpenedForm.loading=!0,showProgress("used_count_form_progress_"+e+"_"+s)},hideProgress:function(){cur.vkmobileUsedCountOpenedForm.loading=!1,hideProgress("used_count_form_progress_"+e+"_"+s)},onFail:function(o){return val(i,o),show(i),!0},onDone:function(){val("used_count_column_"+e+"_"+s,t),hide(o),delete cur.vkmobileUsedCountOpenedForm}})}},usedCountKeyDown:function(o){o.keyCode==KEY.ESC?cur.vkmobileUsedCountOpenedForm&&(hide(cur.vkmobileUsedCountOpenedForm),delete cur.vkmobileUsedCountOpenedForm):(o.keyCode==KEY.ENTER||o.keyCode==KEY.RETURN)&&Vkmobile.setMsisdnPromoCodeUsedCount()},usedCountMouseDown:function(o){var e=o.target,s=!1;if(cur.vkmobileUsedCountOpenedForm&&(s=cur.vkmobileUsedCountOpenedForm),s){for(;e.parentNode;){if(e==s)return;e=e.parentNode}hide(s),delete cur.vkmobileUsedCountOpenedForm}},openPromoCodeUsedCountForm:function(o,e){var s=ge("used_count_form_"+o+"_"+e),n=ge("used_count_form_input_"+o+"_"+e),r=val("used_count_column_"+o+"_"+e).replace(/[^0-9]/g,""),t=ge("used_count_form_error_"+o+"_"+e);val(t,""),hide(t),val(n,r),show(s),elfocus(n),cur.vkmobileUsedCountOpenedForm=s,s.inited||(addEvent(document,"keydown",Vkmobile.usedCountKeyDown),addEvent(document,"mousedown",Vkmobile.usedCountMouseDown),cur.destroy.push(function(){removeEvent(document,"keydown",Vkmobile.usedCountKeyDown),removeEvent(document,"mousedown",Vkmobile.usedCountMouseDown),delete cur.vkmobileUsedCountOpenedForm}))},showInfoProgress:function(o){hide(o),showProgress(domNS(o))},showInfoBtn:function(o){show(o),hideProgress(domNS(o))},hideInfoProgress:function(o){var e=domNS(o);hideProgress(e),addClass(domNS(e),"vkmobile_info_done_text_shown")},updateSubsription:function(o,e,s){ajax.post("/cvkmobile",{act:"a_update_subscription",user_id:e,hash:s},{showProgress:Vkmobile.showInfoProgress.pbind(o),hideProgress:Vkmobile.hideInfoProgress.pbind(o)})},cancelSubscription:function(o,e,s){ajax.post("/cvkmobile",{act:"a_cancel_subscription",user_id:e,hash:s},{showProgress:Vkmobile.showInfoProgress.pbind(o),hideProgress:Vkmobile.hideInfoProgress.pbind(o)})},sendExclusiveStickersBox:function(o,e,s){showFastBox(getLang("global_box_confirm_title"),getLang("vkmobile_send_exclusive_stickers_ask"),getLang("box_no"),!1,getLang("box_yes"),Vkmobile.sendExclusiveStickers.pbind(o,e,s))},sendExclusiveStickers:function(o,e,s){curBox().hide(),ajax.post("/cvkmobile",{act:"a_send_exclusive_stickers",user_id:e,hash:s},{showProgress:Vkmobile.showInfoProgress.pbind(o),onFail:Vkmobile.showInfoBtn.pbind(o),onDone:Vkmobile.hideInfoProgress.pbind(o)})},unBindMsisdn:function(o,e,s,n){ajax.post("/cvkmobile",{act:"a_unbind_msisdn",user_id:e,msisdn:s,hash:n},{showProgress:Vkmobile.showInfoProgress.pbind(o),hideProgress:Vkmobile.hideInfoProgress.pbind(o),onDone:hide.pbind("vkmobile_user_msisdn_"+e+"_"+s)})},addFreeStickers:function(o,e,s){ajax.post("/cvkmobile",{act:"a_add_free_stickers",user_id:e,hash:s},{showProgress:Vkmobile.showInfoProgress.pbind(o),hideProgress:Vkmobile.hideInfoProgress.pbind(o)})},onChangeSearchInfo:function(o){cur.vkmobileSearchInfoTimeout&&clearTimeout(cur.vkmobileSearchInfoTimeout),cur.vkmobileSearchInfoTimeout=setTimeout(Vkmobile.searchInfo.pbind(!1,o),450)},searchInfo:function(o,e){var s=ge("vkmobile_info_content");ajax.post("/cvkmobile",{act:"info",q:e,no_full:1},{onDone:function(o){val(s,o),e?nav.objLoc.q=e:delete nav.objLoc.q,nav.setLoc(nav.objLoc)}})},searchPromoCode:function(o){var e=trim(val("promocode_str")),s=cur.promocodeShowBy.val();e||(e="",s=""),ajax.post("/cvkmobile",{str:e,get_by:s,results:1},{onDone:function(o,n){nav.setLoc(extend(nav.objLoc,{str:e,get_by:s})),val("promocode_list",n)},showProgress:lockButton.pbind(o),hideProgress:unlockButton.pbind(o)})},showPromoCodeBox:function(o,e){showBox("/cvkmobile",{act:"promocode_box",pid:e||0},{params:{width:450}})},savePromoCode:function(o,e){if(!cur.vkmobilePromoCodeLoading){var s=val("promocode"),n=val("vkmobile_promocode_date"),r=parseInt(val("count")),t=val("comment");if(!r>0)return notaBene("count");var i="vkmobile_promocode_box_error";hide(i),cur.vkmobilePromoCodeLoading=!0,ajax.post("/cvkmobile",{act:"set_promocode",pid:o,hash:e,code:s,date:n,count:r,comment:t},{onDone:function(o,e){delete cur.vkmobilePromoCodeLoading,2==o&&(val(i,"Такой промо-код уже существует",e),show(i)),1==o&&(curBox().hide(),showDoneBox(e),setTimeout(nav.go.pbind("/cvkmobile"),400))},showProgress:curBox().showProgress,hideProgress:curBox().hideProgress})}},deletePromoCode:function(o,e,s){ajax.post("/cvkmobile",{act:"delete_promocode",pid:e,hash:s},{onDone:function(o,s){hide("promocode_row"+e),curBox().hide(),showDoneBox(s),setTimeout(nav.go.pbind("/cvkmobile"),400)},showProgress:curBox().showProgress,hideProgress:curBox().hideProgress})},showMorePromoCode:function(o){ajax.post("/cvkmobile",{offset:cur.vkmobile_promocode_offset||100},{onDone:function(e,s){return s?(cur.vkmobile_promocode_offset=e,void val("promocode_list",val("promocode_list")+s)):hide(o)},showProgress:lockButton.pbind(o),hideProgress:unlockButton.pbind(o)})},showSettingsBox:function(o){showBox("/cvkmobile",{act:"settings_box"},{params:{width:450}})},exportStatsBox:function(o){showBox("/cvkmobile",{act:"export_stats_box"},{params:{width:450}})},saveSettings:function(o){var e={act:"save_settings",display_status:cur.promocode_display_status.val(),app_username:val("vkmobile_app_username"),app_password:val("vkmobile_app_password"),user_username:val("vkmobile_user_username"),user_password:val("vkmobile_user_password")};ajax.post("/cvkmobile",e,{onDone:function(){curBox().hide(),showDoneBox("Изменения успешно сохранены")},showProgress:curBox().showProgress,hideProgress:curBox().hideProgress})},search:function(o){var e=trim(val("promocode_log_str")),s=cur.promocodeStatsShowBy.val();e||(e="",s=""),ajax.post("/cvkmobile",{act:"promocode_stats",str:e,get_by:s,results:1},{onDone:function(o){nav.setLoc(extend(nav.objLoc,{act:"promocode_stats",str:e,get_by:s})),val("promocode_list",o)},showProgress:lockButton.pbind(o),hideProgress:unlockButton.pbind(o)})},setPeriod:function(o){nav.objLoc.period=o,nav.go(nav.objLoc)}};try{stManager.done("internal/cvkmobile.js")}catch(e){}